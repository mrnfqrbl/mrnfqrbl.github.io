<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的 GitHub Pages 网站</title>
</head>
<body>  

<!-- 容器显示 GitHub 文件内容 -->
<div id="fileContent" style="white-space: pre-wrap;"></div>

<script>
    // 请求 GitHub API 获取 nai-2.5d 文件的内容
    fetch('https://api.github.com/repos/mrnfqrbl/sd/contents/nai-2.5d?ref=main')
        .then(response => response.json())
        .then(data => {
            if (data && data.content) {
                // 获取文件的 Base64 编码内容
                const base64Content = data.content;

                // 解码 Base64 内容
                const decodedContent = decodeBase64ToUTF8(base64Content);

                // 解析内容并按标题和段落分类
                const parsedContent = parseContent(decodedContent);

                // 显示文件内容
                document.getElementById('fileContent').innerHTML = `<h2>${data.name}</h2><div>${parsedContent}</div>`;
            } else {
                document.getElementById('fileContent').innerHTML = '文件未找到或内容为空。';
            }
        })
        .catch(error => {
            console.error('获取文件失败:', error);
            document.getElementById('fileContent').innerHTML = '无法加载文件内容。';
        });

    // 解码 Base64 编码并正确解析为 UTF-8 格式
    function decodeBase64ToUTF8(base64Str) {
        const binaryData = atob(base64Str);  // 解码 Base64 内容为二进制字符串
        const byteArray = new Uint8Array(binaryData.length);

        // 将二进制数据转化为字节数组
        for (let i = 0; i < binaryData.length; i++) {
            byteArray[i] = binaryData.charCodeAt(i);
        }

        // 使用 TextDecoder 将字节数组解码为 UTF-8 字符串
        const decoder = new TextDecoder('utf-8');
        return decoder.decode(byteArray);
    }

    // 解析内容，按##、# 和段落分隔并赋予id
    function parseContent(content) {
        const lines = content.split('\n').filter(line => line.trim() !== '');

        let parsedHTML = '';
        let currentId = 1; // 用于生成唯一的ID

        let currentSectionId = null;
        let currentSubsectionId = null;

        lines.forEach(line => {
            // 判断大标题 (##)
            if (line.startsWith('## ')) {
                // 添加大标题
                parsedHTML += `<h2 id="section-${currentId}">${line.substring(3).trim()}</h2>`;
                currentSectionId = currentId; // 记录当前大标题的ID
                currentId++; // 增加ID
            }
            // 判断小标题 (#)
            else if (line.startsWith('# ')) {
                // 添加小标题
                parsedHTML += `<h3 id="subsection-${currentId}">${line.substring(2).trim()}</h3>`;
                currentSubsectionId = currentId; // 记录当前小标题的ID
                currentId++; // 增加ID
            }
            // 判断普通段落内容
            else {
                if (currentSectionId && currentSubsectionId) {
                    parsedHTML += `<p id="paragraph-${currentId}">${line.trim()}</p>`;
                    currentId++; // 增加ID
                }
            }
        });

        console.log("解析后的内容：", parsedHTML); // 打印解析后的内容
        return parsedHTML;
    }
</script>

</body>
</html>
